@*
	Iván Loire - www.iloire.com
	Please readme README file for license terms.

	ASP.NET MVC3 ACME Invocing app (demo app for training purposes)
*@

@model Invoice

@{
    ViewBag.Title = "Edit";
}

@section Header{
  <script type="text/javascript">

      function clearErrors() {
          $('#msgErrorNewInvoiceDetails').html('');
          $('#msgError').html('');
      }
      
      function writeError(control, msg) {
          var err_msg = '<div class="alert-message error"><a class="close" href="#">×</a><p>' + msg + '</p></div>';
          $('#' + control).html (err_msg);
      }

      $(document).ready(function () {

          $('.closeModal').live('click', function () {
              $('#my-modal').modal('hide');
          });

          $('#my-modal form').live('submit', function () {
              clearErrors();

              $.post($(this).attr('action'), $(this).serialize(), function (data, status) {
                  $('#my-modal').modal('hide');
                  $("#invoiceDetailsList").html(data);

              }).error(function (error, status, a, b) {
                  writeError('msgError', 'Error processing request. Please check errors and try again!');
                  $('.modal-body p.body').html(error.responseText);

              });
              return false;
          });



          $('a.newDetailInvoice').live('click', function () {
              clearErrors();

              //alert('sdf');
              var id = $(this).attr("idInvoice");
              var url = '/InvoiceDetails/Create/' + id;

              $.ajax({
                  url: url,
                  context: document.body,
                  success: function (data) {
                      $('.modal-body p.body').html(data);
                      $(this).addClass("done");
                      $('#my-modal').modal('show');
                      $('#Article').focus();
                  },
                  error: function (err) {
                      writeError('msgErrorNewInvoiceDetails', err);
                      //alert('error: ' + err);
                  }
              });
              return false;
          });

          $('.deleteInvoiceDetails').live('click', function () {
              clearErrors();

              var id = $(this).attr("idInvoiceDetails");
              var url = '/InvoiceDetails/Delete/' + id;
              $.ajax({
                  url: url,
                  context: document.body,
                  success: function (data) {
                      //alert(data);
                      $('.modal-body p.body').html(data);
                      $(this).addClass("done");
                      $('#my-modal').modal('show');
                      $('#Article').focus();
                  },
                  error: function (err) {
                      alert('error: ' + JSON.stringify(err));
                      writeError('msgErrorNewInvoiceDetails', err);
                  }
              });
              return false;
          });

          

          $('.editInvoiceDetails').live('click', function () {
              clearErrors();

              var id = $(this).attr("idInvoiceDetails");
              var url = '/InvoiceDetails/Edit/' + id;
              $.ajax({
                  url: url,
                  context: document.body,
                  success: function (data) {
                      //alert(data);
                      $('.modal-body p.body').html(data);
                      $(this).addClass("done");
                      $('#my-modal').modal('show');
                      $('#Article').focus();
                  },
                  error: function (err) {
                      alert('error: ' + JSON.stringify(err));
                      writeError('msgErrorNewInvoiceDetails', err);
                  }
              });


              return false;
          });




      }); 
    </script>
}

<div class="span7">

@using (Html.BeginForm())
{
    @Html.ValidationSummary(true)
    <fieldset>
        <legend>Invoice edition</legend>

        @Html.HiddenFor(model => model.InvoiceID)

        <div class="clearfix">
            @Html.LabelFor(model => model.CustomerID, "Customer")
        
        <div class="input">
            @Html.DropDownList("CustomerID", String.Empty)
            @Html.ValidationMessageFor(model => model.CustomerID)
        </div>
		</div>

        <div class="clearfix">
            @Html.LabelFor(model => model.Notes)
        
        <div class="input">
            @Html.TextAreaFor(model => model.Notes)
            @Html.ValidationMessageFor(model => model.Notes)
        </div>
		</div>

        <div class="clearfix">
            @Html.LabelFor(model => model.TimeStamp)
        
        <div class="input">
            @Html.EditorFor(model => model.TimeStamp, "Calendar")
            @Html.ValidationMessageFor(model => model.TimeStamp)
        </div>
		</div>

        <div class="clearfix">
            @Html.LabelFor(model => model.DueDate)
        
        <div class="input">
            @Html.EditorFor(model => model.DueDate, "Calendar")
            @Html.ValidationMessageFor(model => model.DueDate)
        </div>
		</div>

        <div class="clearfix">
            @Html.LabelFor(model => model.Paid)
        
        <div class="input">
            @Html.EditorFor(model => model.Paid)
            @Html.ValidationMessageFor(model => model.Paid)
        </div>
		</div>

		<div class="actions">
            <input type="submit" class="btn primary" value="Save" />
			@Html.ActionLink("Back to Invoices", "Index", null, new { @class = "btn" })
        </div>
    </fieldset>
}
</div>

<div class="span14">
  
        <div id="my-modal" class="modal hide fade">
        <div class="modal-header">
            <a href="#" class="close">&times;</a>
            <h3>Invoice detail</h3>
        </div>
        <div class="modal-body">
            <div id="msgError"></div>
            <p class="body">
                   
            </p>
        </div>
        <div class="modal-footer">
             
        </div>
        </div>

     <p>
         <a href="@Url.Action("Create", "InvoiceDetails", new { id = Model.InvoiceID })" idInvoice="@Model.InvoiceID" class="btn newDetailInvoice">Create new invoice details</a>
     </p>
     <div id="msgErrorNewInvoiceDetails"></div>

    <div id="invoiceDetailsList">
        @{Html.RenderAction("IndexByInvoice", "InvoiceDetails", new {id = Model.InvoiceID});}
    </div>
</div>